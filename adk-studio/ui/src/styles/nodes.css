/**
 * Node CSS Styles for ADK Studio v2.0
 * 
 * Defines rounded corners, shadows, borders for both light and dark themes.
 * Uses CSS variables from theme.css for theme-aware styling.
 * 
 * Requirements: 7.1
 */

/* ============================================
   Base Node Styles
   ============================================ */

.node-base {
  background: var(--surface-card);
  border: 2px solid var(--border-default);
  border-radius: 8px;
  min-width: 180px;
  color: var(--text-primary);
  transition: all 0.2s ease;
  box-shadow: var(--shadow-md);
  overflow: hidden;
}

.node-base:hover {
  border-color: var(--accent-primary);
  box-shadow: var(--shadow-lg);
}

/* Selection state */
.node-base.node-selected {
  border-color: var(--accent-primary) !important;
  box-shadow: 0 0 0 2px rgba(15, 138, 138, 0.3), var(--shadow-lg);
}

/* Active/running state */
/* @see Requirement 10.3: Green glow effect on active node */
/* @see Requirement 10.5: Highlight execution path */
.node-base.node-active {
  border-color: var(--accent-success) !important;
  box-shadow: 
    0 0 20px rgba(56, 161, 105, 0.5),
    0 0 40px rgba(56, 161, 105, 0.3),
    var(--shadow-lg);
  animation: activeGlow 2s ease-in-out infinite;
}

/* Green glow animation for active nodes */
@keyframes activeGlow {
  0%, 100% {
    box-shadow: 
      0 0 20px rgba(56, 161, 105, 0.5),
      0 0 40px rgba(56, 161, 105, 0.3),
      var(--shadow-lg);
  }
  50% {
    box-shadow: 
      0 0 30px rgba(56, 161, 105, 0.7),
      0 0 60px rgba(56, 161, 105, 0.4),
      var(--shadow-lg);
  }
}

/* Interrupted state - HITL waiting for human input */
/* @see trigger-input-flow Requirement 3.3: Interrupt visual indicator */
.node-base.node-interrupted {
  border-color: var(--accent-warning) !important;
  box-shadow: 
    0 0 20px rgba(245, 158, 11, 0.5),
    0 0 40px rgba(245, 158, 11, 0.3),
    var(--shadow-lg);
  animation: interruptedPulse 1.5s ease-in-out infinite;
}

/* Pulsing animation for interrupted nodes */
@keyframes interruptedPulse {
  0%, 100% {
    box-shadow: 
      0 0 20px rgba(245, 158, 11, 0.5),
      0 0 40px rgba(245, 158, 11, 0.3),
      var(--shadow-lg);
    border-color: var(--accent-warning);
  }
  50% {
    box-shadow: 
      0 0 30px rgba(245, 158, 11, 0.7),
      0 0 60px rgba(245, 158, 11, 0.5),
      var(--shadow-lg);
    border-color: #f59e0b;
  }
}

/* Execution path node (completed but part of current path) */
.node-base.node-execution-path {
  border-color: var(--accent-success) !important;
  box-shadow: 0 0 10px rgba(56, 161, 105, 0.3), var(--shadow-md);
}

/* ============================================
   Node Header Styles
   ============================================ */

.node-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  font-weight: 600;
  font-size: 13px;
  color: white;
  border-radius: 6px 6px 0 0;
}

/* Node type header colors */
.node-header-agent {
  background: var(--node-agent);
}

.node-header-sequential {
  background: var(--node-sequential);
}

.node-header-loop {
  background: var(--node-loop);
}

.node-header-parallel {
  background: var(--node-parallel);
}

.node-header-router {
  background: var(--node-router);
}

.node-header-start {
  background: var(--accent-success);
}

.node-header-end {
  background: var(--accent-error);
}

.node-icon {
  font-size: 14px;
  flex-shrink: 0;
}

.node-label {
  font-size: 13px;
  font-weight: 600;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Node type badge - similar to action nodes */
.node-type-badge {
  font-size: 9px;
  font-weight: 500;
  text-transform: lowercase;
  padding: 2px 6px;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.9);
  letter-spacing: 0.3px;
  flex-shrink: 0;
}

/* ============================================
   Node Body Styles
   ============================================ */

.node-body {
  padding: 8px 12px;
  font-size: 12px;
  color: var(--text-secondary);
}

.node-body-section {
  padding-top: 8px;
  margin-top: 8px;
  border-top: 1px solid var(--border-default);
}

/* ============================================
   Status Indicator Styles
   ============================================ */

.status-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-left: auto;
}

.status-indicator.status-idle {
  /* No visual indicator for idle state */
  display: none;
}

.status-indicator.status-running {
  background: rgba(255, 255, 255, 0.2);
}

.status-indicator.status-success {
  background: rgba(255, 255, 255, 0.2);
}

.status-indicator.status-error {
  background: rgba(255, 255, 255, 0.2);
}

/* Interrupted state indicator - amber/warning color */
/* @see trigger-input-flow Requirement 3.3: Interrupt visual indicator */
.status-indicator.status-interrupted {
  background: rgba(245, 158, 11, 0.3);
  animation: statusPulse 1.5s ease-in-out infinite;
}

/* Pulsing animation for interrupted status indicator */
@keyframes statusPulse {
  0%, 100% {
    background: rgba(245, 158, 11, 0.3);
    transform: scale(1);
  }
  50% {
    background: rgba(245, 158, 11, 0.5);
    transform: scale(1.1);
  }
}

/* Interrupted icon styling */
.status-interrupted-icon {
  color: white;
  font-size: 12px;
  font-weight: bold;
}

/* Spinner animation for running state */
.status-spinner {
  display: inline-block;
  animation: spin 1s linear infinite;
  font-size: 12px;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Success checkmark */
.status-success-icon {
  color: white;
  font-size: 12px;
  font-weight: bold;
}

/* Error X icon */
.status-error-icon {
  color: white;
  font-size: 12px;
  font-weight: bold;
}

/* ============================================
   Sub-Agent Styles
   ============================================ */

.sub-agent {
  padding: 6px 8px;
  background: var(--bg-secondary);
  border-radius: 4px;
  margin: 4px 0;
  border: 1px solid var(--border-default);
  font-size: 11px;
  color: var(--text-secondary);
  transition: all 0.2s ease;
}

.sub-agent-active {
  background: rgba(56, 161, 105, 0.15);
  border-color: var(--accent-success);
  color: var(--accent-success);
  box-shadow: 0 0 8px rgba(56, 161, 105, 0.3);
}

.sub-agent-index {
  color: var(--text-muted);
  margin-right: 4px;
}

.sub-agent-name {
  font-weight: 500;
}

/* ============================================
   Tool Badge Styles
   ============================================ */

.tool-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 6px;
}

.tool-badge {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 2px 6px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-default);
  border-radius: 10px;
  font-size: 10px;
  color: var(--text-secondary);
  white-space: nowrap;
}

.tool-badge-icon {
  font-size: 10px;
}

.tool-badge-name {
  max-width: 80px;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ============================================
   Route Styles (for Router nodes)
   ============================================ */

.route {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  background: var(--bg-secondary);
  border-radius: 4px;
  margin: 4px 0;
  font-size: 11px;
  border: 1px solid var(--border-default);
  transition: all 0.2s ease;
}

.route-active {
  background: rgba(56, 161, 105, 0.15);
  border-color: var(--accent-success);
}

.route-condition {
  color: var(--accent-warning);
  font-weight: 500;
}

.route-arrow {
  color: var(--text-muted);
}

.route-target {
  color: var(--text-secondary);
}

.route-active .route-target {
  color: var(--accent-success);
}

/* ============================================
   Model Info Styles
   ============================================ */

.model-info {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--text-secondary);
  padding: 4px 0;
}

.model-icon {
  font-size: 12px;
}

.model-name {
  font-family: monospace;
  font-size: 10px;
}

/* ============================================
   Iteration Info Styles (for Loop nodes)
   ============================================ */

.iteration-info {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  color: var(--text-secondary);
  padding: 4px 0;
}

.iteration-badge {
  padding: 2px 6px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-default);
  border-radius: 4px;
  font-size: 10px;
  font-weight: 500;
}

.iteration-badge-active {
  background: rgba(214, 158, 46, 0.15);
  border-color: var(--node-loop);
  color: var(--node-loop);
}

/* ============================================
   Handle Styles
   ============================================ */

.node-handle {
  width: 10px !important;
  height: 10px !important;
  background: var(--handle-color) !important;
  border: 2px solid var(--surface-card) !important;
}

.node-handle:hover {
  transform: scale(1.2);
}

/* ============================================
   Dark Theme Specific Overrides
   ============================================ */

:root[data-theme="dark"] .node-base {
  box-shadow: var(--shadow-md), 0 0 0 1px rgba(255, 255, 255, 0.05);
}

:root[data-theme="dark"] .node-base:hover {
  box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255, 255, 255, 0.1);
}

:root[data-theme="dark"] .node-base.node-selected {
  box-shadow: 0 0 0 2px rgba(79, 209, 197, 0.4), var(--shadow-lg);
}

:root[data-theme="dark"] .sub-agent {
  background: rgba(255, 255, 255, 0.05);
}

:root[data-theme="dark"] .tool-badge {
  background: rgba(255, 255, 255, 0.08);
}

:root[data-theme="dark"] .route {
  background: rgba(255, 255, 255, 0.05);
}

/* ============================================
   Light Theme Specific Overrides
   ============================================ */

:root[data-theme="light"] .node-header {
  /* Slightly darker text shadow for better readability */
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

:root[data-theme="light"] .sub-agent {
  background: var(--bg-primary);
}

:root[data-theme="light"] .tool-badge {
  background: var(--bg-primary);
}

:root[data-theme="light"] .route {
  background: var(--bg-primary);
}

/* ============================================
   Thought Indicator (for LLM nodes)
   ============================================ */

.thought-indicator {
  display: inline-flex;
  align-items: center;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
