{
  "id": "tpl-incident-response",
  "version": "1.0.0",
  "name": "Incident Response Bot",
  "description": "Automatically classify incident severity, page on-call for P1s, create tickets, and post status updates to Slack",
  "settings": {
    "default_model": "gemini-2.0-flash",
    "env_vars": {},
    "layoutDirection": "LR",
    "layoutMode": "free",
    "debugMode": false
  },
  "agents": {
    "severity_classifier": {
      "type": "llm",
      "model": "gemini-2.0-flash",
      "instruction": "You are an incident severity classifier for a production SaaS platform. Given an alert or incident report, classify its severity and extract key details.\n\nSeverity levels:\n- P1 (Critical): Full outage, data loss, security breach, >50% users affected\n- P2 (High): Partial outage, degraded performance for many users, key feature broken\n- P3 (Medium): Minor feature broken, workaround available, <10% users affected\n\nOutput JSON only:\n{\"severity\": \"P1\", \"title\": \"Database cluster unreachable\", \"affected_service\": \"api-gateway\", \"impact\": \"All API requests failing, 100% of users affected\", \"recommended_actions\": [\"Page on-call DBA\", \"Failover to secondary cluster\", \"Enable maintenance page\"]}",
      "tools": [],
      "sub_agents": [],
      "position": { "x": 0, "y": 0 }
    },
    "status_writer": {
      "type": "llm",
      "model": "gemini-2.0-flash",
      "instruction": "You are a technical communications specialist. Given incident details, severity, and routing information, write a clear, professional status update for the engineering Slack channel.\n\nFormat:\nðŸš¨ **[SEVERITY] Incident: [Title]**\nðŸ“‹ Ticket: [ticket_id]\nðŸ”§ Affected: [service]\nðŸ‘¤ Assigned: [team]\nðŸ“ Impact: [description]\nâ±ï¸ Next update in: [timeframe based on severity]\n\nKeep it concise, factual, and actionable. No speculation.",
      "tools": [],
      "sub_agents": [],
      "position": { "x": 0, "y": 0 }
    }
  },
  "tools": {},
  "tool_configs": {},
  "actionNodes": {
    "manual_trigger": {
      "type": "trigger",
      "id": "manual_trigger",
      "name": "Alert Received",
      "description": "Triggered by monitoring alert (Datadog, PagerDuty, CloudWatch) or manual report",
      "triggerType": "manual",
      "manual": {
        "buttonLabel": "Report Incident",
        "defaultPrompt": "ALERT: Database connection pool exhausted on api-gateway-prod. Error rate spiked to 95% across all endpoints. Started 3 minutes ago. CloudWatch alarm: HighErrorRate triggered. 2,400 users currently affected.",
        "showPromptInput": true
      },
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 30000 },
      "mapping": { "outputKey": "trigger_input" }
    },
    "route_severity": {
      "type": "switch",
      "id": "route_severity",
      "name": "Route by Severity",
      "description": "Route P1 to PagerDuty, P2 to on-call Slack, P3 to ticket queue",
      "evaluationMode": "first_match",
      "conditions": [
        { "id": "p1", "name": "P1 Critical", "field": "classification.severity", "operator": "eq", "value": "P1", "outputPort": "p1" },
        { "id": "p2", "name": "P2 High", "field": "classification.severity", "operator": "eq", "value": "P2", "outputPort": "p2" }
      ],
      "defaultBranch": "p3",
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "route_result" }
    },
    "page_oncall": {
      "type": "http",
      "id": "page_oncall",
      "name": "Page On-Call (P1)",
      "description": "Trigger PagerDuty incident for P1 critical alerts",
      "method": "POST",
      "url": "https://events.pagerduty.com/v2/enqueue",
      "auth": { "type": "none" },
      "headers": { "Content-Type": "application/json" },
      "body": {
        "type": "json",
        "content": "{\"routing_key\": \"{{PAGERDUTY_ROUTING_KEY}}\", \"event_action\": \"trigger\", \"payload\": {\"summary\": \"{{classification.title}}\", \"severity\": \"critical\", \"source\": \"{{classification.affected_service}}\", \"custom_details\": {\"impact\": \"{{classification.impact}}\"}}}"
      },
      "response": { "type": "json" },
      "errorHandling": { "mode": "retry", "retryCount": 3, "retryDelay": 2000 },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 15000 },
      "mapping": { "outputKey": "pager_result" }
    },
    "set_p1": {
      "type": "set",
      "id": "set_p1",
      "name": "P1 Response Plan",
      "description": "Set P1 response parameters â€” war room, 15-min update cadence",
      "mode": "set",
      "variables": [
        { "key": "response_team", "value": "incident_commanders", "valueType": "string", "isSecret": false },
        { "key": "update_cadence_min", "value": "15", "valueType": "number", "isSecret": false },
        { "key": "war_room", "value": "#incident-war-room", "valueType": "string", "isSecret": false },
        { "key": "escalation_timeout_min", "value": "30", "valueType": "number", "isSecret": false }
      ],
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "response_plan" }
    },
    "set_p2": {
      "type": "set",
      "id": "set_p2",
      "name": "P2 Response Plan",
      "description": "Set P2 response parameters â€” on-call team, 30-min updates",
      "mode": "set",
      "variables": [
        { "key": "response_team", "value": "oncall_engineers", "valueType": "string", "isSecret": false },
        { "key": "update_cadence_min", "value": "30", "valueType": "number", "isSecret": false },
        { "key": "war_room", "value": "#oncall-alerts", "valueType": "string", "isSecret": false },
        { "key": "escalation_timeout_min", "value": "60", "valueType": "number", "isSecret": false }
      ],
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "response_plan" }
    },
    "set_p3": {
      "type": "set",
      "id": "set_p3",
      "name": "P3 Response Plan",
      "description": "Set P3 response parameters â€” ticket queue, next business day",
      "mode": "set",
      "variables": [
        { "key": "response_team", "value": "platform_team", "valueType": "string", "isSecret": false },
        { "key": "update_cadence_min", "value": "120", "valueType": "number", "isSecret": false },
        { "key": "war_room", "value": "#platform-bugs", "valueType": "string", "isSecret": false },
        { "key": "escalation_timeout_min", "value": "480", "valueType": "number", "isSecret": false }
      ],
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "response_plan" }
    },
    "merge_responses": {
      "type": "merge",
      "id": "merge_responses",
      "name": "Merge Responses",
      "description": "Rejoin all severity branches before status update",
      "mode": "wait_all",
      "combineStrategy": "object",
      "timeout": { "enabled": true, "ms": 20000, "behavior": "continue" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 25000 },
      "mapping": { "outputKey": "merged_response" }
    },
    "create_ticket": {
      "type": "http",
      "id": "create_ticket",
      "name": "Create Jira Ticket",
      "description": "Create an incident ticket in Jira with all details",
      "method": "POST",
      "url": "https://{{JIRA_DOMAIN}}.atlassian.net/rest/api/3/issue",
      "auth": { "type": "basic", "basic": { "username": "{{JIRA_EMAIL}}", "password": "{{JIRA_API_TOKEN}}" } },
      "headers": { "Content-Type": "application/json" },
      "body": {
        "type": "json",
        "content": "{\"fields\": {\"project\": {\"key\": \"INC\"}, \"summary\": \"[{{classification.severity}}] {{classification.title}}\", \"description\": {\"type\": \"doc\", \"version\": 1, \"content\": [{\"type\": \"paragraph\", \"content\": [{\"type\": \"text\", \"text\": \"{{classification.impact}}\"}]}]}, \"issuetype\": {\"name\": \"Incident\"}, \"priority\": {\"name\": \"{{classification.severity}}\"}}}"
      },
      "response": { "type": "json" },
      "errorHandling": { "mode": "retry", "retryCount": 2, "retryDelay": 1000 },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 15000 },
      "mapping": { "outputKey": "ticket" }
    },
    "post_status": {
      "type": "http",
      "id": "post_status",
      "name": "Post to Slack",
      "description": "Post incident status update to the appropriate Slack channel",
      "method": "POST",
      "url": "https://slack.com/api/chat.postMessage",
      "auth": { "type": "bearer", "bearer": { "token": "{{SLACK_BOT_TOKEN}}" } },
      "headers": { "Content-Type": "application/json" },
      "body": {
        "type": "json",
        "content": "{\"channel\": \"{{response_plan.war_room}}\", \"text\": \"{{status_update}}\", \"unfurl_links\": false}"
      },
      "response": { "type": "json" },
      "errorHandling": { "mode": "retry", "retryCount": 2, "retryDelay": 1000 },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "slack_result" }
    }
  },
  "workflow": {
    "type": "graph",
    "edges": [
      { "from": "manual_trigger", "to": "START" },
      { "from": "START", "to": "severity_classifier" },
      { "from": "severity_classifier", "to": "route_severity" },
      { "from": "route_severity", "to": "page_oncall", "fromPort": "p1" },
      { "from": "page_oncall", "to": "set_p1" },
      { "from": "route_severity", "to": "set_p2", "fromPort": "p2" },
      { "from": "route_severity", "to": "set_p3", "fromPort": "p3" },
      { "from": "set_p1", "to": "merge_responses" },
      { "from": "set_p2", "to": "merge_responses" },
      { "from": "set_p3", "to": "merge_responses" },
      { "from": "merge_responses", "to": "create_ticket" },
      { "from": "create_ticket", "to": "status_writer" },
      { "from": "status_writer", "to": "post_status" },
      { "from": "post_status", "to": "END" }
    ],
    "conditions": []
  },
  "created_at": "2026-02-08T00:00:00Z",
  "updated_at": "2026-02-08T00:00:00Z"
}